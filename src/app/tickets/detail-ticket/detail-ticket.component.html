<div class="row" style="background-color: #f5f7f9;margin-top: -10px;">
  <div style="margin: 10px 10px 10px 20px;">
    <a routerLink="/tickets/filters/all-tickets" class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
      <b><i class="fas fa-arrow-left"></i> Go Back</b>
     </a>
     &nbsp;
    <button type="button" *ngIf="canreply" (click)="reply()"  class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
      <b><i class="fas fa-reply"></i> Reply</b>
     </button>
     &nbsp;

     <button type="button" *ngIf="canforward" (click)="forward()" class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
      <b><i class="fas fa-share"></i> Forward</b>
     </button>
     &nbsp;

     <button type="button" (click)="closeticket()"  class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
      <b><i class="far fa-check-circle"></i> Close</b>
     </button>
     &nbsp;

    <button type="button" *ngIf="canedit" class="btn btn-outline-default" (click)="editmodal(editcontent)" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
     <b><i class="sl-icon-note"></i> Edit</b>
    </button>
    &nbsp;
    <button type="button" *ngIf="candlt" class="btn btn-outline-default" (click)="deletemodal(deletecontent)" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
      <b><i class="far fa-trash-alt"></i> Delete</b>
     </button>
  </div>
</div>

<br>


<div class="row">
  <div class="col-lg-10 col-md-9 col-sm-12">
    <div class="row">
      <div class="col-lg-9 col-md-9 col-sm-12">
      <div class="card">

        <div class="card-body" *ngIf="loadingdata">
          <div style="margin-top: 20%;margin-left: 50%;margin-right: auto;margin-bottom: 20%;" ><i class="fa fa-spinner fa-spin fa-2x"></i></div>
        </div>

          <div class="card-body" *ngIf="!loadingdata">
              <h3 class="card-title" style="margin-left: 6px;margin-bottom: 6px;">
                <i class="fas fa-envelope"></i>
                <span style="margin-left: 16px;">{{subject}}</span>
              </h3>
              <span style="margin-left: 41px;font-size: 12px;">
                Created by <span style="font-weight: bold;">{{name}}</span>
              </span>
              <ul class="list-unstyled m-t-40">
                  <li class="media">
                      <div class="media-body">
                          <h5 class="mt-0 mb-1">
                            <div class="row">
                              <div class="col-lg-1 col-md-2 col-sm-3">
                                <img src="{{baseurl}}{{img}}" alt="profile picture" width="40px" data-identifyelement="377">
                              </div>
                              <div class="col-lg-10 col-md-10 col-sm-9">
                                {{name}}
                                <br>
                                <small> {{datewithtimezone | timeAgo}}</small>
                              </div>
                            </div>
                          </h5>

                          <div class="row">
                            <div class="col-lg-1 col-md-2 col-sm-3">

                            </div>
                            <div class="col-lg-11 col-md-10 col-sm-9">
                              <span [innerHTML]="discription"></span>
                            </div>

                          </div>

                          <span *ngFor="let r of replies">
                            <div style="background-color: #f5f7f9;">
                              <h5 class="mt-0 mb-1">
                                <br>
                                <div class="row">
                                  <div class="col-lg-1 col-md-2 col-sm-3">
                                    <img src="{{baseurl}}{{r.agGu.uploadphoto}}" alt="profile picture" width="40px" data-identifyelement="377">
                                  </div>
                                  <div class="col-lg-8 col-md-10 col-sm-9">
                                    {{r.agGu.fullname}} <small>replied</small>
                                    <br>
                                    <small>{{timezonedate(r.datetime) | timeAgo}}</small>
                                  </div>
                                </div>
                              </h5>

                              <div class="row">
                                <div class="col-lg-1 col-md-2 col-sm-3">

                                </div>
                                <div class="col-lg-11 col-md-10 col-sm-9">
                                  <span [innerHTML]="r.description"></span>
                                </div>

                              </div>
                            </div>
                            <br>
                          </span>

                          <br>

                          <div class="row" style="background-color: #f5f7f9;height: 50px;align-items: center;">
                            <div class="col-12">

                              <img src="{{baseurl}}{{img}}" alt="profile picture" width="40px" data-identifyelement="377">

                              &nbsp;&nbsp;
                              <button type="button" *ngIf="canreply" (click)="reply()" class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
                                <b><i class="fas fa-reply"></i> Reply</b>
                               </button>
                               &nbsp;

                               <button type="button" *ngIf="canforward" (click)="forward()" class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
                                <b><i class="fas fa-share"></i> Forward</b>
                               </button>
                            </div>
                          </div>

                      </div>
                  </li>
                  <hr>

              </ul>
          </div>
      </div>
      <div class="card" *ngIf = "replyblock">
          <div class="card-body">
              <h4 class="m-b-20">Write a reply</h4>
              <form method="post" #freply="ngForm">
                <ckeditor [editor]="Editor" [(ngModel)]="this.ticketdata.reply" required #reply="ngModel" id="reply" name="reply" data-identifyelement="228" ></ckeditor>

                <br>
                <div style="float: right;">

                  <button type="button" (click)="closereply()"  class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
                      <b>Cancel</b>
                    </button>
                   &nbsp;
                   <button  class="btn btn-dark" (click)="ticketreply()" [disabled]="!freply.valid" style="width: 100px;border-radius: 5px;background-image: linear-gradient(to bottom,#264966,#12344d);font-weight: 400;color:white">
                    <i class="fa fa-spinner fa-spin" *ngIf="loading"></i>
                     Send</button>
                  </div>
              </form>
          </div>
      </div>

      <div class="card" *ngIf = "forwardblock">
        <div class="card-body">
            <h4 class="m-b-20">Forward</h4>
            <form method="post" (ngSubmit)="forwardreply()" #f="ngForm">

              <label style="font-size: 12px;">To (Email addess) <span style="color: red;">*</span></label>
                <input type="email" class="form-control" [(ngModel)]="this.ticketdata.forwardemail" name="forwardemail" required  #forwardemail="ngModel">
                <small class="form-text text-danger" *ngIf="!forwardemail.valid && (forwardemail.dirty || forwardemail.touched)">Please enter a email address!</small>
              <br>

              <ckeditor [editor]="Editor" [(ngModel)]="this.ticketdata.forward" [data]="this.ticketdata.forward" required #forward="ngModel" id="forward" name="forward" data-identifyelement="228" ></ckeditor>

              <br>
              <div style="float: right;">

                <button type="button" (click)="closereply()"  class="btn btn-outline-default" style="width: 94px;font-size: 13px;color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
                    <b>Cancel</b>
                  </button>
                 &nbsp;
                 <button  class="btn btn-dark" [disabled]="!f.valid" style="width: 100px;border-radius: 5px;background-image: linear-gradient(to bottom,#264966,#12344d);font-weight: 400;color:white">
                  <i class="fa fa-spinner fa-spin" *ngIf="loading"></i>
                   Forward</button>
                </div>
            </form>
        </div>
    </div>

  </div>


    <div class="col-lg-3 col-md-3 col-sm-12">
      <div class="card">
        <div class="card-body" *ngIf="loadingdata">
          <div style="margin-top: 20%;margin-left: 50%;margin-right: auto;margin-bottom: 20%;" ><i class="fa fa-spinner fa-spin fa-2x"></i></div>
        </div>

          <div class="card-body" *ngIf="!loadingdata">
            <h4 class="card-title">
              <span *ngIf="tstatus == 'Open'" style="color: blue;">
                {{tstatus}}
              </span>
              <span *ngIf="tstatus == 'Pending'" style="color: orange;">
                {{tstatus}}
              </span>
              <span *ngIf="tstatus == 'Close'" style="color: red;">
                {{tstatus}}
              </span>
              <span *ngIf="tstatus == 'Resolved'" style="color: green;">
                {{tstatus}}
              </span>
            </h4>
            <fieldset class="radio">
              <label>
                  <input type="radio" value="true" name="viewtickets" checked> FIRST RESPONSE DUE
              </label>
            </fieldset>
            <p> by  <i class="fa fa-spinner fa-spin" *ngIf="dateloader"></i> {{firstresdate | date: dateformat}}</p>
            <fieldset class="radio">
              <label>
                  <input type="radio" value="0" name="due" checked> RESOLUTION DUE | <a (click)="duedate(true)"  style="color: blue;cursor: pointer;">Edit</a>
              </label>
            </fieldset>
            <div *ngIf="showduedate">
              <input class="form-control" *ngIf="showduedate" [(ngModel)]="this.ticketdata.resolutionduedate" name="resolutionduedate" #resolutionduedate="ngModel" type="datetime-local" id="example-datetime-local-input">
              <br>
              <button  class="btn btn-dark" (click)="updateresolutionduedate()"  style="width: auto;margin-right: 10px;border-radius: 5px;background-image: linear-gradient(to bottom,#264966,#12344d);font-weight: 400;color:white">
                <i class="fa fa-spinner fa-spin" *ngIf="loading"></i>
                 Update
              </button>
              <a (click)="duedate(false)"  class="btn btn-outline-default" style="color:black;border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);">
                <b> Cancel </b>
             </a>
             <br>
            </div>

            <p>by <i class="fa fa-spinner fa-spin" *ngIf="dateloader"></i> {{resolutionduedate | date: dateformat}}</p>
            <hr>

            <h6>PROPERTIES</h6>
            <form class="form" (ngSubmit)="changesstatus()" #f="ngForm" >

              <div class="row">
                <div class="col-12">
                  <label  >Tags</label>
                  <select class="form-control" [(ngModel)]="this.ticketdata.tags" name="tags"  #tags="ngModel">
                    <option *ngFor="let tags of tagdrop" [value]="tags.tagGuid">{{tags.tagname}}</option>
                  </select>
                  </div>
              </div>

              <br>

              <div class="row">
                <div class="col-12">
                  <label style="font-size: 12px;">What do you need help with?</label>
                  <div class="row">
                    <div class="col-12">
                  <select class="form-control" (change)="helpdropdown()" [(ngModel)]="this.ticketdata.needhelp" name="needhelp" #needhelp="ngModel">
                    <option *ngFor="let drop1 of dropdowndata1">{{drop1.drdtext}}</option>
                  </select>
                  </div>
                  </div>
                </div>
              </div>
              <br>

              <div class="row" style="margin-left: 10px;">
                <div class="col-12" style="border-left: 2px dotted #cfd7df;height: 75px;">
                  <label style="font-size: 12px;">We can help you with</label>
                  <div class="row">
                    <div class="col-12">
                  <select class="form-control" [(ngModel)]="this.ticketdata.helpyou" name="helpyou" #helpyou="ngModel">
                    <option *ngFor="let drop2 of dropdowndata2filt">{{drop2.drdtext}}</option>
                  </select>
                  </div>
                  </div>
                </div>
              </div>


              <div class="row">
                <div class="col-12">

                  <label style="font-size: 12px;">Contact number</label>
                  <input type="text" class="form-control" [(ngModel)]="this.ticketdata.contactno"  #contactno="ngModel"  name="contactno"  maxlength="14" minlength="8" (change)="checknumber(this.ticketdata.contactno)">
                  <small class="form-text text-danger" *ngIf="!contactno.valid && (contactno.dirty || contactno.touched)">Please enter a Phone number!</small>
                </div>
              </div>

              <div class="row">
                <div class="col-12">

                  <label style="font-size: 12px;">Property address</label>
                  <input type="text" class="form-control" [(ngModel)]="this.ticketdata.propertyadd"  #propertyadd="ngModel"  name="propertyadd">
                  <!-- <small class="form-text text-danger" >Please enter a email address!</small> -->
                  </div>
              </div>


              <br>
              <div class="row">
                <div class="col-12">

                  <label style="font-size: 12px;">Invoice / Quote / Project number</label>
                  <input type="text" class="form-control" [(ngModel)]="this.ticketdata.invoiceno"  #invoiceno="ngModel"  name="invoiceno">
                  <!-- <small class="form-text text-danger" >Please enter a email address!</small> -->
                  </div>
              </div>


              <div class="row">
                <div class="col-12">
                  <label>Type</label>
                  <div class="row">
                    <div class="col-12">
                  <select class="form-control" [(ngModel)]="this.ticketdata.type" name="type" #type="ngModel">
                    <option *ngFor="let types of typedrop" [value]="types.typeGuid">{{types.name}}</option>
                  </select>
                  </div>
                  </div>
                </div>
              </div>

            <div class="row">
              <div class="col-12">
                <label>Status</label>
                <div class="row">
                  <div class="col-12">
                <select class="form-control" [(ngModel)]="this.ticketdata.status" name="status"  #status="ngModel">

                  <option>Open</option>
                  <option>Close</option>
                  <option>Resolved</option>
                  <option>Pending</option>
                  <option>Waiting on Customer</option>
                  <option>Waiting on Third Party</option>
                </select>
                </div>
                </div>
                </div>
              </div>

              <div class="row">
                <div class="col-12">
                  <label>Priority</label>
                  <div class="row">
                    <div class="col-12">
                  <select class="form-control" [(ngModel)]="this.ticketdata.priority" (change)="prioritychange()" name="priority"  #priority="ngModel">

                    <option>Low</option>
                    <option>Medium</option>
                    <option>High</option>
                    <option>Urgent</option>
                  </select>
                  </div>
                  </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <label class="mr-sm-2" for="groupname">Group</label>
                              <ng-multiselect-dropdown
                              [placeholder]="'Select Group'"
                              name="groupname"
                              #groups="ngModel"
                              [data]="groupname"
                              [(ngModel)]="this.ticketdata.groups"
                              [settings]="groupdropdownSettings"
                              (onSelect)="Groupselect($event)"
                              [disabled]="!cangroupchange">
                          </ng-multiselect-dropdown>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <label class="mr-sm-2" for="agentname">Agent</label>
                              <ng-multiselect-dropdown
                              [placeholder]="'Select Agent'"
                              name="agentname"
                              #agents="ngModel"
                              [data]="agentname"
                              [(ngModel)]="this.ticketdata.agents"
                              [settings]="agentsdropdownSettings"
                              (onSelect)="Agentselect($event)"
                              [disabled]="!canedit">
                          </ng-multiselect-dropdown>
                  </div>
                </div>
                <br>
                <div class="row">
                  <div class="col-12">
                    <button  class="btn btn-dark" id="btnsubmit" style="width: 100%;border-radius: 5px;background-image: linear-gradient(to bottom,#264966,#12344d);font-weight: 400;color:white">
                      <i class="fa fa-spinner fa-spin" *ngIf="loading"></i>
                       Update</button>
                  </div>
                </div>
              </form>

        </div>
    </div>
    </div>
  </div>

  </div>


  <div class="col-lg-2 col-md-3 col-sm-12">
  <div class="card" style="border-radius: 20px;">
    <a data-toggle="collapse" class="collapsible" (click)="isCollapsed1 = !isCollapsed1" [attr.aria-expanded]="!isCollapsed1" aria-controls="collapseExample">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 128 128" class="accordion-image app-icon--normal" data-identifyElement="368"><path d="M72.7 16.5c-8.5 0-13.6 6.6-13.6 12.5 0 5.8 4.3 9.2 10.2 9.2 5.9 0 13.8-4.5 13.8-12.2 0-7.7-7.4-9.5-10.4-9.5m8.9 78.6c.8 1.1.7 2.7-.4 3.6-8.7 7.3-18.9 12.6-24.8 14-6.4 1.5-11.4 1-11.9-5.9s8-36.3 8.6-39.5c.5-2.6-5.7.1-10.7 2.6-1.5.7-3.3.1-4-1.3-.6-1.2-.2-2.6.9-3.4 8.8-6.2 19.7-12 28.9-14.4 5.3-1.3 8.4.3 8.6 6.4.2 6.1-8.6 34.1-9.3 37.9-1 5.5 5.7 2.1 10.5-.8 1.1-.6 2.7-.3 3.6.8" data-identifyElement="369"></path></svg>
      CONTACT DETAILS</a>
      <div class="card-body" *ngIf="loadingdata">
        <div style="margin-top: 20%;margin-left: 50%;margin-right: auto;margin-bottom: 20%;" ><i class="fa fa-spinner fa-spin fa-2x"></i></div>
      </div>

        <div class="card-body" *ngIf="!loadingdata">
      <div class="content" [ngbCollapse]="isCollapsed1" class="panel-collapse collapse">
        <div data-test-id="emptyContactDetail" class="requester-info-sidebar__present" data-identifyelement="375">
          <p data-identifyelement="376">
            <img src="{{baseurl}}{{img}}" alt="profile picture" width="70px" data-identifyelement="377">
          </p>
          <p class="requester-info-sidebar__present__empty" data-identifyelement="378">
            <b>{{name}}</b>
          </p>
          <h6>Email</h6>
          <p class="requester-info-sidebar__present__item-info" data-identifyelement="379">
           <a href="mailto:{{email}}"><i class="fa fa-envelope"></i>  {{email}}</a>
          </p>
          <h6>Workphone</h6>
          <p class="requester-info-sidebar__present__item-info" data-identifyelement="379">
           <a href="tel:{{workphone}}"><i class="fa fa-phone"></i>  {{workphone}}</a>
          </p>
        </div>


      </div>

    </div>
  </div>
</div>
</div>


<ng-template #deletecontent let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title"><i class="fas fa-ticket-alt"></i> Delete</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">

      <h3>Are you sure you want to delete this ticket ?</h3>

  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger btn-raised mr-1" (click)="Delete()">
      <i class="fa fa-spinner fa-spin" *ngIf="loading"></i> Yes Delete</button>
    <button type="button" class="btn btn-light" (click)="c('Close click')">Close</button>
  </div>
</ng-template>


<ng-template #editcontent let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title"><i class="fas fa-ticket-alt"></i> Edit Ticket</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body" style="margin-left: 10px;">
    <form class="form" (ngSubmit)="update()" #f1="ngForm" >

      <div class="row">
        <div class="col-12">
          <label class="mr-sm-2" for="agentdrop">Contact <span style="color: red;">*</span></label>
                    <ng-multiselect-dropdown
                    [placeholder]="'Select Contact'"
                    name="agentdrop"
                    #agentdrop="ngModel"
                    [data]="dropdownList"
                    [(ngModel)]="this.ticketdata.agentdrop"
                    [settings]="agentdropdownSettings"
                    (onSelect)="onItemSelect($event)" aria-required>
                </ng-multiselect-dropdown>
        </div>

      </div>


      <br>
      <div class="row">
        <div class="col-12">

          <label style="font-size: 12px;">Subject <span style="color: red;">*</span></label>
          <input type="text" class="form-control" [(ngModel)]="this.ticketdata.subject"  #subject="ngModel"  name="subject" required  >
          <!-- <small class="form-text text-danger" >Please enter a email address!</small> -->
          </div>
      </div>


        <br>

        <div class="row">
          <div class="col-12">
            <label class="mr-sm-2" for="discription">Discription <span style="color: red;">*</span></label>
            <div class="card">
              <!-- <textarea class="form-control" [(ngModel)]="this.ticketdata.Description" #discription="ngModel" name="discription"></textarea> -->
              <!-- <ckeditor [editor]="Editor" [(ngModel)]="this.ticketdata.Description" #discription="ngModel" id="Description" name="discription" data-identifyelement="228" ></ckeditor> -->
              <quill-editor [style]="{height: '200px'}" [(ngModel)]="this.ticketdata.Description" #Description="ngModel" id="Description"  name="Description"></quill-editor>
            </div>
          </div>
        </div>


    </form>


  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-dark"  [disabled]="!f1.valid" style="background-image: linear-gradient(to bottom,#264966,#12344d);border-radius: 5px;font-weight: 400;color:white" (click)="update()"> <i class="fa fa-spinner fa-spin" *ngIf="loading"></i> Update Ticket</button>
    <button type="button" class="btn btn-light" style="border-radius: 5px;border: 1px solid #cfd7df;background-image: linear-gradient(to bottom,#fff,#f3f5f7);background-image: linear-gradient(to bottom,#fff,#f3f5f7);" (click)="c('Close click')">Close</button>
  </div>
</ng-template>
